<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit-cover">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>My awesome App</title>
    <link rel="stylesheet" href="./style.css" type="text/css">
    <script src="./client_validations.js"></script>
    <!-- Bootstrap-->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://getbootstrap.com/docs/5.2/assets/css/docs.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/js/bootstrap.bundle.min.js"></script>
    <!-- incluir handlebars desde el CDN -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/handlebars.js/4.7.7/handlebars.min.js"></script>
  </head>
  <body>

 

    <div style="background-color:white;padding:20px">
      <div style="background-color:LightGray;padding:20px;height: auto;">
         

          <form action="/api/productos" name="product_form" id="product_form"  method="POST">
            <div class="m-4">

                <div class="text-left">


                    <div class="row">
                        <div class="col-12">
                            <h1 style="color:blue">Ingrese Producto</h1>
                        </div>

                    </div>


                    <div class="row">
                        <div class="col-12">
                            <label for="title" class="form-label">Nombre</label>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-12">
                        <input type="text" class="form-control" name="title" id="title" />
                        </div>
                    
                    </div>


                    <div class="row">
                        <div class="col-12">
                                <label for="price" class="form-label">Precio</label> 
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-12">
                            <input type="number" class="form-control"  name="price" id="price" />
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-12">
                            <label for="thumbnail" class="form-label">Foto Url</label>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-12">
                            <input type="text" class="form-control" name="thumbnail" id="thumbnail" />
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-12">
                            <br/>
                            <button type="submit" class="btn btn-success">Enviar</button>
                        </div> 
                    </div>


                </div>

                <br/>
            </div>
          </form>
          <div id="lstProductos"></div> <!-- para inyectar el resultado -->

          <br/>

        

      </div>



    </div>


  <script>


    fetch('/api/productos')
    .then(response => response.json())
    .then(products => {
        // fetch template from server
        fetch('/productList.hbs')
          .then(response => response.text())
          .then(templateStr => {
            const template = Handlebars.compile(templateStr); // compila la plantilla
            const html = template({products}); // genera el html
            document.getElementById("lstProductos").innerHTML = html; // inyecta el html
          });
    });

  </script>

<script>
  
  let productForm = document.getElementById('product_form');

  async function postData(url = '', data = {}) {
    const response = await fetch(url, {
      method: 'POST',
      mode: 'cors', 
      cache: 'no-cache',
      credentials: 'same-origin', 
      headers: {
        'Content-Type': 'application/json'
      },
      redirect: 'follow', 
      referrerPolicy: 'no-referrer',
      body: JSON.stringify(data) 
    });
    return response.json();
  }

  productForm.addEventListener('submit', function(e) {
    e.preventDefault();
    if (validateForm()) {

      let title = document.forms["product_form"]["title"].value;
      let price = document.forms["product_form"]["price"].value;
      let thumbnail = document.forms["product_form"]["thumbnail"].value;

      postData('/api/productos', { title, price, thumbnail})
      .then((data) => {
        document.forms["product_form"]["title"].value = '';
        document.forms["product_form"]["price"].value = '';
        document.forms["product_form"]["thumbnail"].value = '';
      });

    }
  });

</script>

  
  </body>
</html>